apiVersion: v1
kind: ConfigMap
metadata:
  name: observability-stack
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  observability-stack.json: |
    {
      "annotations": {
        "list": []
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 1,
      "links": [],
      "panels": [
        {
          "gridPos": { "h": 2, "w": 24, "x": 0, "y": 0 },
          "id": 100,
          "options": { "content": "# Observability Stack Dashboard\nMonitoring the health of Prometheus, Loki, Tempo, OpenTelemetry Collector, Beyla, and Fluent-bit", "mode": "markdown" },
          "title": "",
          "type": "text"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "mappings": [
                { "options": { "0": { "color": "red", "index": 0, "text": "DOWN" }, "1": { "color": "green", "index": 1, "text": "UP" } }, "type": "value" }
              ],
              "thresholds": { "mode": "absolute", "steps": [ { "color": "red", "value": null }, { "color": "green", "value": 1 } ] }
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 4, "x": 0, "y": 2 },
          "id": 1,
          "options": { "colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "expr": "up{job=\"kube-prometheus-stack-prometheus\"}", "refId": "A" }],
          "title": "Prometheus",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "mappings": [
                { "options": { "0": { "color": "red", "index": 0, "text": "DOWN" }, "1": { "color": "green", "index": 1, "text": "UP" } }, "type": "value" }
              ],
              "thresholds": { "mode": "absolute", "steps": [ { "color": "red", "value": null }, { "color": "green", "value": 1 } ] }
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 4, "x": 4, "y": 2 },
          "id": 2,
          "options": { "colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "expr": "up{job=\"kube-prometheus-stack-alertmanager\"}", "refId": "A" }],
          "title": "Alertmanager",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "mappings": [
                { "options": { "0": { "color": "red", "index": 0, "text": "DOWN" }, "1": { "color": "green", "index": 1, "text": "UP" } }, "type": "value" }
              ],
              "thresholds": { "mode": "absolute", "steps": [ { "color": "red", "value": null }, { "color": "green", "value": 1 } ] }
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 4, "x": 8, "y": 2 },
          "id": 3,
          "options": { "colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "expr": "count(loki_build_info)", "refId": "A" }],
          "title": "Loki",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "mappings": [
                { "options": { "0": { "color": "red", "index": 0, "text": "DOWN" }, "1": { "color": "green", "index": 1, "text": "UP" } }, "type": "value" }
              ],
              "thresholds": { "mode": "absolute", "steps": [ { "color": "red", "value": null }, { "color": "green", "value": 1 } ] }
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 4, "x": 12, "y": 2 },
          "id": 4,
          "options": { "colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "expr": "count(tempo_build_info)", "refId": "A" }],
          "title": "Tempo",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "mappings": [
                { "options": { "0": { "color": "red", "index": 0, "text": "DOWN" }, "1": { "color": "green", "index": 1, "text": "UP" } }, "type": "value" }
              ],
              "thresholds": { "mode": "absolute", "steps": [ { "color": "red", "value": null }, { "color": "green", "value": 1 } ] }
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 4, "x": 16, "y": 2 },
          "id": 5,
          "options": { "colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "expr": "count(otelcol_process_uptime)", "refId": "A" }],
          "title": "OTel Collector",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": {
            "defaults": {
              "mappings": [],
              "thresholds": { "mode": "absolute", "steps": [ { "color": "red", "value": null }, { "color": "green", "value": 1 } ] }
            },
            "overrides": []
          },
          "gridPos": { "h": 4, "w": 4, "x": 20, "y": 2 },
          "id": 6,
          "options": { "colorMode": "background", "graphMode": "none", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "expr": "count(beyla_build_info)", "refId": "A" }],
          "title": "Beyla",
          "type": "stat"
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 6 },
          "id": 10,
          "title": "Prometheus Metrics",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
          "gridPos": { "h": 4, "w": 6, "x": 0, "y": 7 },
          "id": 11,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "expr": "count(up)", "refId": "A" }],
          "title": "Total Targets",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
          "gridPos": { "h": 4, "w": 6, "x": 6, "y": 7 },
          "id": 12,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "expr": "count(up == 1)", "refId": "A" }],
          "title": "Healthy Targets",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "percentunit", "min": 0, "max": 1, "thresholds": { "mode": "absolute", "steps": [ { "color": "red", "value": null }, { "color": "yellow", "value": 0.9 }, { "color": "green", "value": 0.99 } ] } }, "overrides": [] },
          "gridPos": { "h": 4, "w": 6, "x": 12, "y": 7 },
          "id": 13,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "expr": "sum(up) / count(up)", "refId": "A" }],
          "title": "Target Health %",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
          "gridPos": { "h": 4, "w": 6, "x": 18, "y": 7 },
          "id": 14,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "expr": "prometheus_tsdb_head_series", "refId": "A" }],
          "title": "Time Series",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "ops" }, "overrides": [] },
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 11 },
          "id": 15,
          "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
          "targets": [{ "expr": "rate(prometheus_tsdb_head_samples_appended_total[5m])", "legendFormat": "Samples/sec", "refId": "A" }],
          "title": "Prometheus Ingestion Rate",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "bytes" }, "overrides": [] },
          "gridPos": { "h": 8, "w": 12, "x": 12, "y": 11 },
          "id": 16,
          "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
          "targets": [
            { "expr": "prometheus_tsdb_head_chunks_storage_size_bytes", "legendFormat": "Head Chunks", "refId": "A" },
            { "expr": "prometheus_tsdb_wal_storage_size_bytes", "legendFormat": "WAL", "refId": "B" }
          ],
          "title": "Prometheus Storage",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 19 },
          "id": 20,
          "title": "Loki Logs",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 20 },
          "id": 21,
          "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
          "targets": [{ "expr": "rate(loki_distributor_lines_received_total[5m])", "legendFormat": "Lines/sec", "refId": "A" }],
          "title": "Loki Log Ingestion Rate",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "decbytes" }, "overrides": [] },
          "gridPos": { "h": 8, "w": 12, "x": 12, "y": 20 },
          "id": 22,
          "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
          "targets": [{ "expr": "rate(loki_distributor_bytes_received_total[5m])", "legendFormat": "Bytes/sec", "refId": "A" }],
          "title": "Loki Bytes Ingestion Rate",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 28 },
          "id": 30,
          "title": "Tempo Traces",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
          "gridPos": { "h": 8, "w": 12, "x": 0, "y": 29 },
          "id": 31,
          "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
          "targets": [{ "expr": "rate(tempo_distributor_spans_received_total[5m])", "legendFormat": "Spans/sec", "refId": "A" }],
          "title": "Tempo Span Ingestion Rate",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "decbytes" }, "overrides": [] },
          "gridPos": { "h": 8, "w": 12, "x": 12, "y": 29 },
          "id": 32,
          "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
          "targets": [{ "expr": "rate(tempo_distributor_bytes_received_total[5m])", "legendFormat": "Bytes/sec", "refId": "A" }],
          "title": "Tempo Bytes Ingestion Rate",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 37 },
          "id": 40,
          "title": "OpenTelemetry Collector",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
          "gridPos": { "h": 8, "w": 8, "x": 0, "y": 38 },
          "id": 41,
          "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
          "targets": [{ "expr": "rate(otelcol_receiver_accepted_spans[5m])", "legendFormat": "{{receiver}}", "refId": "A" }],
          "title": "OTel Received Spans/sec",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
          "gridPos": { "h": 8, "w": 8, "x": 8, "y": 38 },
          "id": 42,
          "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
          "targets": [{ "expr": "rate(otelcol_receiver_accepted_metric_points[5m])", "legendFormat": "{{receiver}}", "refId": "A" }],
          "title": "OTel Received Metrics/sec",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
          "gridPos": { "h": 8, "w": 8, "x": 16, "y": 38 },
          "id": 43,
          "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
          "targets": [{ "expr": "rate(otelcol_exporter_sent_spans[5m])", "legendFormat": "{{exporter}}", "refId": "A" }],
          "title": "OTel Exported Spans/sec",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 46 },
          "id": 50,
          "title": "Beyla eBPF",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
          "gridPos": { "h": 4, "w": 8, "x": 0, "y": 47 },
          "id": 51,
          "options": { "colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
          "targets": [{ "expr": "count(beyla_build_info)", "refId": "A" }],
          "title": "Beyla Instances",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "prometheus" },
          "fieldConfig": { "defaults": { "unit": "short" }, "overrides": [] },
          "gridPos": { "h": 8, "w": 16, "x": 8, "y": 47 },
          "id": 52,
          "options": { "legend": { "calcs": [], "displayMode": "list", "placement": "bottom" }, "tooltip": { "mode": "multi" } },
          "targets": [{ "expr": "rate(http_server_request_duration_seconds_count[5m])", "legendFormat": "{{service_name}}", "refId": "A" }],
          "title": "Beyla HTTP Requests/sec by Service",
          "type": "timeseries"
        }
      ],
      "schemaVersion": 39,
      "tags": ["observability", "infrastructure"],
      "templating": { "list": [] },
      "time": { "from": "now-1h", "to": "now" },
      "timepicker": {},
      "timezone": "browser",
      "title": "Observability Stack",
      "uid": "observability-stack",
      "version": 1
    }
